@page "/vendor/input"
@using EventsManagementInterface.Data.Models
@using EventsManagementInterface.Data.Models.Vendor
@using EventsManagementInterface.Data.Services
@inject VendorService vendorService

<PageTitle>Vendor Input</PageTitle>
<form @onsubmit="SubmitVendorInput">
    <div class="card-custom p-3">
        <div class="card-body-custom">
            <div class="row mb-3  justify-content-center mt-2">
                <div class="form-group col-lg-2 col-md-4 col-sm-4 text-center">
                    <label for="vendorInputGuestIndentificationNumber">Guest Identification Number</label>
                    <input type="number" min="1000" max="9999" class="form-control text-center" id="vendorInputGuestIndentificationNumber" @bind-value="vendorInput.GuestIdentificationNumber">
                </div>
                <div class="form-group col-lg-12 col-sm-12">
                    <div class="row justify-content-center mt-2">
                        <button class="vendor-input-button" type="button" @onclick="() => InsertGuestIdentificationNumber(1)">1</button>
                        <button class="vendor-input-button" type="button" @onclick="() => InsertGuestIdentificationNumber(2)">2</button>
                        <button class="vendor-input-button" type="button" @onclick="() => InsertGuestIdentificationNumber(3)">3</button>
                    </div>
                    <div class="row justify-content-center mt-2">
                        <button class="vendor-input-button" type="button" @onclick="() => InsertGuestIdentificationNumber(4)">4</button>
                        <button class="vendor-input-button" type="button" @onclick="() => InsertGuestIdentificationNumber(5)">5</button>
                        <button class="vendor-input-button" type="button" @onclick="() => InsertGuestIdentificationNumber(6)">6</button>
                    </div>
                    <div class="row justify-content-center mt-2">
                        <button class="vendor-input-button" type="button" @onclick="() => InsertGuestIdentificationNumber(7)">7</button>
                        <button class="vendor-input-button" type="button" @onclick="() => InsertGuestIdentificationNumber(8)">8</button>
                        <button class="vendor-input-button" type="button" @onclick="() => InsertGuestIdentificationNumber(9)">9</button>
                    </div>
                    <div class="row justify-content-center mt-2">
                        <button class="vendor-input-button" type="button" style="background-color: darkred !important;" @onclick="() => ClearInput()"><span class="oi oi-x" aria-hidden="true"></span></button>
                        <button class="vendor-input-button" type="button" @onclick="() => InsertGuestIdentificationNumber(3)">0</button>
                        <button class="vendor-input-button" type="button" style="background-color: darkgreen !important;" @onclick="() => SubmitVendorInput()"><span class="oi oi-check" aria-hidden="true"></span></button>
                    </div>
                    <div class="row justify-content-center mt-2">
                        <button class="vendor-input-item" type="button" @onclick="() => ShowDrinkMenuModal()">Drink Menu</button>
                    </div>
                </div>

           @*<div class="form-group col-lg-12 col-sm-12">
                    <div class="row justify-content-center mt-2">
                        <button class="vendor-input-item" type="button" @onclick="() => InsertGuestIdentificationNumber(1)">Gin & Tonic</button>
                        <button class="vendor-input-item" type="button" @onclick="() => InsertGuestIdentificationNumber(2)">Beer</button>
                        <button class="vendor-input-item" type="button" @onclick="() => InsertGuestIdentificationNumber(3)">Red Wine</button>
                    </div>
                </div>*@




                <div class="form-group col-lg-12 col-sm-12">
                    <label for="vendorInputAlcoholicDrinks">Alcoholic Drink(s)</label>
                    <select class="form-control" id="vendorInputAlcoholicDrinks" @bind="vendorInput.AlcoholicDrinkToken">
                        <option selected="selected">0</option>
                        @for (int i = 1; i < 11; i++)
                        {
                            <option value="@i">@i</option>
                        }
                    </select>
                </div>
                <div class="form-group col-lg-12 col-sm-12">
                    <label for="vendorInputNonAlcoholicDrinks">Non-Alcoholic Drink(s)</label>
                    <select class="form-control" id="vendorInputNonAlcoholicDrinks" @bind="vendorInput.NonAlcoholicDrinkToken">
                        <option selected="selected">0</option>
                        @for (int i = 1; i < 11; i++)
                        {
                            <option value="@i">@i</option>
                        }
                    </select>
                </div>
                <div class="form-group col-lg-12 col-sm-12">
                    <label for="vendorInputFood">Food</label>
                    <select class="form-control" id="vendorInputFood" @bind="vendorInput.FoodToken">
                        <option selected="selected">0</option>
                        @for (int i = 1; i < 11; i++)
                        {
                            <option value="@i">@i</option>
                        }
                    </select>
                </div>
            </div>

            <input type="submit" class="btn btn-primary" value="Submit" />
        </div>
    </div>
</form>

<Modal @ref="modal">
    <ModalContent Size="ModalSize.Large">
        <ModalHeader>
            <ModalTitle>@baseModal.Title</ModalTitle>
        </ModalHeader>
        <ModalBody>
            <Field>
                <FieldLabel Style="font-weight:100">@baseModal.Message</FieldLabel>
            </Field>
            <Div Class="mb-2"></Div>
            @if (baseModal.Success)
            {
                <Field>
                    <FieldLabel>Tokens Remaining:</FieldLabel>
                    <UnorderedList>
                        @foreach (string tokens in baseModal.TokensRemaining)
                        {
                            <UnorderedListItem>@tokens</UnorderedListItem>
                        }
                    </UnorderedList>
                </Field>
            }
            else
            {
                <Field>
                    <UnorderedList>
                        @foreach (string error in baseModal.Errors)
                        {
                            <UnorderedListItem>@error</UnorderedListItem>
                        }
                    </UnorderedList>
                </Field>
            }
        </ModalBody>
        <ModalFooter>
            <Button Color="Color.Secondary" Clicked="@HideModal">Close</Button>
        </ModalFooter>
    </ModalContent>
</Modal>

<Modal @ref="drinkMenuModal">
    <ModalContent Size="ModalSize.Large">
        <ModalHeader>
            <ModalTitle>Drink Menu</ModalTitle>
        </ModalHeader>
        <ModalBody>
            
        </ModalBody>
        <ModalFooter>
            <Button Color="Color.Secondary" Clicked="@HideDrinkMenuModal">Close</Button>
        </ModalFooter>
    </ModalContent>
</Modal>


@code {
    private VendorInput vendorInput;
    private Modal modal;
    private Modal drinkMenuModal;
    private BaseModal baseModal;

    private Task ShowModal()
    {
        return modal.Show();
    }

    private Task HideModal()
    {
        return modal.Hide();
    }
    
    private Task ShowDrinkMenuModal()
    {
        return modal.Show();
    }

    private Task HideDrinkMenuModal()
    {
        return modal.Hide();
    }


    protected override async Task OnInitializedAsync()
    {
        vendorInput = new VendorInput();
        baseModal = new BaseModal();
        baseModal.Errors = new List<string>();
    }

    public async Task SubmitVendorInput()
    {
        baseModal = await vendorService.SubmitVendorInput(vendorInput);

        ShowModal();

        if (baseModal.Success)
        {
            vendorInput = new VendorInput();
        }
    }

    private void InsertGuestIdentificationNumber(int input) {
        int? integer = null;

        if (vendorInput.GuestIdentificationNumber > 999)
        {
            vendorInput.GuestIdentificationNumber = 0;
            return;
        }

        if (vendorInput.GuestIdentificationNumber == 0)
        {
            integer = int.Parse(vendorInput.GuestIdentificationNumber.ToString() + input.ToString());
            vendorInput.GuestIdentificationNumber = integer.Value;
        }
        else
        {
            vendorInput.GuestIdentificationNumber = int.Parse(vendorInput.GuestIdentificationNumber.ToString() + input.ToString());
        }

    }

    private void ClearInput()
    {
        vendorInput.GuestIdentificationNumber = 0;
        vendorInput.AlcoholicDrinkToken = 0;
        vendorInput.NonAlcoholicDrinkToken = 0;
        vendorInput.FoodToken = 0;
    }

    
}